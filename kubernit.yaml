kernel:
  image: linuxkit/kernel:4.14.48
  cmdline: "console=tty0 ipAddress=192.168.57.2 ipBroadcast=192.167.57.255 ipMask=24"
init:
  - wombat/init:dev
  - wombat/runc:dev
  - wombat/containerd:dev
  - wombat/ca-certificates:dev
  - linuxkit/getty:44730fd0a7c59dbacf5b48b54ba33f551bcf7ef0
onboot:
  - name: sysctl
    image: wombat/sysctl:dev
    binds:
     - /etc/sysctl.d/01-kubernetes.conf:/etc/sysctl.d/01-kubernetes.conf
    readonly: false
  - name: sysfs
    image: wombat/sysfs:dev
  - name: metadata
    image: wombat/metadata:dev
  - name: format
    image: wombat/format:dev
  - name: mounts
    image: wombat/mount:dev
    command: ["/usr/bin/mountie", "/var/lib/"]
  - name: dhcpcd
    image: wombat/dhcpcd:dev
    command: ["/sbin/dhcpcd", "--nobackground", "-f", "/dhcpcd.conf", "-1"]
  - name: bridge
    image: busybox:latest
    runtime:
      mkdir: ["/var/lib/cni/conf","/var/lib/cni/bin"]
services:
  - name: rngd
    image: wombat/rngd:dev
    cgroupsPath: systemreserved/rngd
  - name: ntpd
    image: wombat/openntpd:dev
    cgroupsPath: systemreserved/ntpd
  - name: sshd
    image: wombat/sshd:dev
    cgroupsPath: systemreserved/sshd
  - name: kubelet
    image: wombat/kubelet:dev
    cgroupsPath: podruntime/kubelet
files:
  - path: etc/dnsmasq.conf
    source: ./config/contribs/dnsmasq/dnsmasq.conf
  - path: etc/hosts
    contents: |
      192.168.57.21 node1.kubernit.com
      192.168.57.22 node2.kubernit.com
      192.168.57.23 node3.kubernit.com
  - path: /etc/containerd/config.toml
    contents: |
      root = "/var/lib/containerd"
      state = "/run/containerd"
      oom_score = 0

      [grpc]
        address = "/run/containerd/containerd.sock"
        uid = 0
        gid = 0
        max_recv_message_size = 16777216
        max_send_message_size = 16777216

      [debug]
        address = ""
        uid = 0
        gid = 0
        level = ""

      [metrics]
        address = ""
        grpc_histogram = false

      [cgroup]
        path = ""

      [plugins]
        [plugins.cgroups]
          no_prometheus = false
        [plugins.cri]
          stream_server_address = ""
          stream_server_port = "10010"
          enable_selinux = false
          sandbox_image = "k8s.gcr.io/pause:3.1"
          stats_collect_period = 10
          systemd_cgroup = false
          enable_tls_streaming = false
          [plugins.cri.containerd]
            snapshotter = "overlayfs"
            [plugins.cri.containerd.default_runtime]
              runtime_type = "io.containerd.runtime.v1.linux"
              runtime_engine = ""
              runtime_root = ""
            [plugins.cri.containerd.untrusted_workload_runtime]
              runtime_type = ""
              runtime_engine = ""
              runtime_root = ""
          [plugins.cri.cni]
            bin_dir = "/var/lib/cni/bin"
            conf_dir = "/var/lib/cni/conf"
            conf_template = ""
          [plugins.cri.registry]
            [plugins.cri.registry.mirrors]
              [plugins.cri.registry.mirrors."docker.io"]
                endpoint = ["https://registry-1.docker.io"]
        [plugins.diff-service]
          default = ["walking"]
        [plugins.linux]
          shim = "containerd-shim"
          runtime = "runc"
          runtime_root = ""
          no_shim = false
          shim_debug = false
        [plugins.scheduler]
          pause_threshold = 0.02
          deletion_threshold = 0
          mutation_threshold = 100
          schedule_delay = "0s"
          startup_delay = "100ms"
  - path: config/etc/matchbox
    directory: true
  - path: etc/linuxkit.yml
    metadata: yaml
  - path: etc/kubernetes
    symlink: "/var/lib/kubeadm"
  - path: etc/os-release
    contents: |
      PRETTY_NAME="Kubernit Project"
  - path: usr/libexec/kubernetes/kubelet-plugins
    symlink: "/var/lib/kubelet-plugins"
  - path: etc/kubeadm/
    directory: true
  - path: etc/sysctl.d/01-kubernetes.conf
    contents: 'net.ipv4.ip_forward = 1'
  - path: etc/cni/net.d
    directory: true
  - path: opt/cni/bin
    directory: true
  - path: root/.ssh/authorized_keys
    source: ~/.ssh/id_rsa.pub
    mode: "0600"
    optional: true
  - path: etc/kubelet.sh.conf
    contents: |
      KUBELET_ARGS="--container-runtime=remote --container-runtime-endpoint=unix:///run/containerd/containerd.sock"
  - path: run/config/cni.bridge/debug-show-configs
    contents: "1"
  - path: etc/kubeadm/kube-system.init/50-weave.yaml
    source: net.yaml
